<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>CrewCipher - Drag and Drop</title>
    <style>
        body { font-family: Arial, sans-serif; background: #e0f7fa; }
        .container { display: flex; justify-content: space-around; margin-top: 60px; }
        .card { width: 120px; height: 180px; background: #fff; border: 2px solid #00796b; border-radius: 10px; box-shadow: 2px 2px 8px #aaa; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: grab; }
        .door { width: 120px; height: 200px; background: #bdbdbd; border: 3px solid #5d4037; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 22px; color: #5d4037; }
        #result { margin-top: 40px; text-align: center; font-size: 20px; }
    </style>
</head>
<body>
    <h2 style="text-align:center;">CrewCipher - Arraste o crachá até a porta</h2>
    <div class="container">
        <div class="card" id="badge" draggable="true" ondragstart="drag(event)">
            <strong>Crachá</strong>
            <select id="crew">
                <option value="joao">João</option>
                <option value="maria">Maria</option>
                <option value="ana">Ana</option>
            </select>
        </div>
        <div class="door" id="door" ondrop="drop(event)" ondragover="allowDrop(event)">
            Porta
        </div>
    </div>
    <div id="result"></div>
    <script>
        function allowDrop(ev) {
            ev.preventDefault();
        }
        function drag(ev) {
            ev.dataTransfer.setData("text", "badge");
        }
        function drop(ev) {
            ev.preventDefault();
            const crew = document.getElementById('crew').value;
            // Código criptografado (base64 de "ACESSO LIBERADO")
            const code = btoa("ACESSO LIBERADO");
            fetch('/check_access', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ crew, code })
            })
            .then(r => r.json())
            .then(data => {
                if(data.access) {
                    document.getElementById('result').innerHTML = '<span style="color:green;">' + data.decrypted + '</span>';
                } else {
                    document.getElementById('result').innerHTML = '<span style="color:red;">' + data.decrypted + '</span>';
                }
            });
        }
    </script>
</body>
</html>
